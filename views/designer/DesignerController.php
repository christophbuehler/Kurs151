<?phpclass DesignerController extends Controller {    function init() {        // access only for logged in users        if (!Session::get('loggedIn')) {            header('location: ' . LOGIN_VIEW);            exit;        }        // assign page name        $this->smarty->assign('test', "das ist ein test...");    }    function create_diagram() {        if (!isset($_POST['diagramName'])) return array(            'code' => 1,            'msg' => "No diagram name set."        );        $name = stripslashes($_POST['diagramName']);        if (strlen($name) < 5) return array(            'code' => 1,            'msg' => 'Diagram name has to be at least five characters in length.'        );        $db = $this->model->db;        // new diagram query        $sth = $db->prepare("INSERT INTO diagram (userId, name) VALUES (            :userId, :name)");        $sth->execute(array(            ':userId' => Session::get('userId'),            ':name' => $name        ));        return array(            'code' => 0,            'msg' => "Diagram successfully created.",            'id' => $db->lastInsertId()        );    }    /*     * get all diagrams for this user     */    function get_diagrams() {        $db = $this->model->db;        $sth = $db->prepare("SELECT * FROM diagram WHERE userId =            :userId");        $sth->execute(array(            ':userId' => Session::get('userId')        ));        return array(            'diagrams' => $sth->fetchAll()        );    }    /*     * get one specific diagram     */    function get_diagram() {        $db = $this->model->db;        if (!isset($_POST['diagramId'])) return;        $diagramId = $_POST['diagramId'];        $sth = $db->prepare("SELECT * FROM diagram WHERE userId =            :userId AND id = :diagramId");        $sth->execute(array(            ':userId' => Session::get('userId'),            ':diagramId' => $diagramId        ));        if ($sth->rowCount() == 0) return;        return array(            'diagram' => $sth->fetchAll()[0]        );    }    /*     * update diagram information (name, html)     */    function update_diagram() {        if (!isset($_POST['id'])) return;        if (!isset($_POST['name'])) return;        if (!isset($_POST['html'])) return;        $id = $_POST['id'];        $name = stripslashes($_POST['name']);        $html = $_POST['html'];        $db = $this->model->db;        $sth = $db->prepare("UPDATE diagram SET name = :name, html = :html WHERE id = :id");        $sth->execute(array(            ':name' => $name,            ':html' => $html,            ':id' => $id        ));        return array(            'code' => 0,            'msg' => "Success"        );    }}